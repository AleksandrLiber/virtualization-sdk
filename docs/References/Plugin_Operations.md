---
title: Virtualization SDK
---

# Plugin Operations

## Repository Discovery

Discovers the set of [repositories](Glossary.md#repository) for a plugin on an [environment](Glossary.md#environment). For a DBMS, this can correspond to the set of binaries installed on a Unix host.

```python
from dlpx.virtualization import plugin
from generated import RepositoryDefinition

plugin = plugin.Plugin()

@plugin.discovery.repository()
def repository_discovery(source_connection):  
  repository = RepositoryDefinition()
  repository.installPath = "/usr/bin/install"
  repository.version = "1.2.3"
  return [repository]
```

> The above command assumes a [Repository Schema](Schemas_and_Autogenerated_Classes.md#repositorydefinition-schema) defined as:

```json
{
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "installPath": { "type": "string" },
    "version": { "type": "string" }
  },
  "identityFields": ["installPath"],
  "nameField": ["installPath"]    
}
```

### Signature

`def repository_discovery(source_connection)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
source_connection | [SourceConnection](Classes.md#sourceconnection) | The connection associated with the remote environment to run repository discovery

### Returns
A list of [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) objects.

## Source Config Discovery

Discovers the set of [source configs](Glossary.md#source-config) for a plugin for a [repository](Glossary.md#repository). For a DBMS, this can correspond to the set of unique databases running using a particular installation on a Unix host.

```python
from dlpx.virtualization import plugin
from generated import SourceConfigDefinition

plugin = plugin.Plugin()

@plugin.discovery.source_config()
def source_config_discovery(source_connection, repository):
  source_config = SourceConfigDefinition()
  source_config.name = "my_name"
  source_config.port = 10000
  return [source_config]
```

> The above command assumes a [Source Config Schema](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-schema) defined as:

```json
{
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "name": { "type": "string" },
    "port": { "type": "number" }
  },
  "identityFields": ["name"],
  "nameField": ["name"]    
}
```

### Signature

`def source_config_discovery(source_connection)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
source_connection | [SourceConnection](Classes.md#sourceconnection) | The connection to the remote environment the corresponds to the repository.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository to discover source configs for.

### Returns
A list of [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) objects.

## Direct Linked Source Pre-Snapshot

Sets up a [dSource](Glossary.md#dsource) to ingest data. Only applies when using a [Direct Linking](Glossary.md#direct-linking) strategy.
Required to implement for Delphix Engine operations:

* Sync

```python
from dlpx.virtualization import plugin
from generated import SourceConfigDefinition

plugin = plugin.Plugin()

@plugin.linked.pre_snapshot()
def linked_pre_snapshot(direct_source, repository, source_config):
  pass
```

### Signature

`def linked_pre_snapshot(direct_source, repository, source_config)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
direct_source | [DirectSource](Classes.md#directsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.
source_config | [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) | The source config associated with this source.

### Returns
None

## Direct Linked Source Post-Snapshot

Captures metadata from a [dSource](Glossary.md#dsource) once data has been ingested. Only applies when using a [Direct Linking](Glossary.md#direct-linking) strategy.
Required to implement for Delphix Engine operations:

* Sync

```python
from dlpx.virtualization import plugin
from generated import SnapshotDefinition

plugin = plugin.Plugin()

@plugin.linked.post_snapshot()
def linked_post_snapshot(direct_source, repository, source_config):
  snapshot = SnapshotDefinition()
  snapshot.transaction_id = 1000
  return snapshot
```

> The above command assumes a [Snapshot Schema](Schemas_and_Autogenerated_Classes.md#snapshot-schema) defined as:

```json
{
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "transactionId": { "type": "integer" }
  }
}
```

### Signature

`def linked_post_snapshot(direct_source, repository, source_config)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
direct_source | [DirectSource](Classes.md#directsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.
source_config | [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) | The source config associated with this source.

### Returns
[SnapshotDefinition](Schemas_and_Autogenerated_Classes.md#snapshotdefinition-class)

## Staged Linked Source Pre-Snapshot

Sets up a [dSource](Glossary.md#dsource) to ingest data. Only applies when using a [Staged Linking](Glossary.md#staged-linking) strategy.
Required to implement for Delphix Engine operations:

* Sync

```python
from dlpx.virtualization import plugin

plugin = plugin.Plugin()

@plugin.linked.pre_snapshot()
def linked_pre_snapshot(staged_source, repository, source_config):
  pass
```

### Signature

`def linked_pre_snapshot(staged_source, repository, source_config)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
staged_source | [StagedSource](Classes.md#stagedsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.
source_config | [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) | The source config associated with this source.

### Returns
None

## Staged Linked Source Post-Snapshot

Captures metadata from a [dSource](Glossary.md#dsource) once data has been ingested. Only applies when using a [Staged Linking](Glossary.md#staged-linking) strategy.
Required to implement for Delphix Engine operations:

* Sync

```python
from dlpx.virtualization import plugin
from generated import SnapshotDefinition

plugin = plugin.Plugin()

@plugin.linked.post_snapshot()
def linked_post_snapshot(staged_source, repository, source_config):
  snapshot = SnapshotDefinition()
  snapshot.transaction_id = 1000
  return snapshot
```

> The above command assumes a [Snapshot Schema](Schemas_and_Autogenerated_Classes.md#snapshot-schema) defined as:

```json
{
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "transactionId": { "type": "integer" }
  }
}
```

### Signature

`def linked_post_snapshot(staged_source, repository, source_config)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
staged_source | [StagedSource](Classes.md#stagedsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.
source_config | [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) | The source config associated with this source.

### Returns
[SnapshotDefinition](Schemas_and_Autogenerated_Classes.md#snapshotdefinition-class)

## Staged Linked Source Start-Staging

Sets up a [Staging Source](Glossary.md#staging-source) to ingest data. Only applies when using a [Staged Linking](Glossary.md#staged-linking) strategy.
Required to implement for Delphix Engine operations:

* Enable

```python
from dlpx.virtualization import plugin

plugin = plugin.Plugin()

@plugin.linked.start_staging()
def start_staging(staged_source, repository, source_config):
  pass
```

### Signature

`def start_staging(staged_source, repository, source_config)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
staged_source | [StagedSource](Classes.md#stagedsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.
source_config | [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) | The source config associated with this source.

### Returns
None


## Staged Linked Source Stop-Staging

Quiesces a [Staging Source](Glossary.md#staging-source) to pause ingestion. Only applies when using a [Staged Linking](Glossary.md#staged-linking) strategy.
Required to implement for Delphix Engine operations:

* Enable

```python
from dlpx.virtualization import plugin

plugin = plugin.Plugin()

@plugin.linked.stop_staging()
def stop_staging(staged_source, repository, source_config):
  pass
```

### Signature

`def stop_staging(staged_source, repository, source_config)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
staged_source | [StagedSource](Classes.md#stagedsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.
source_config | [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) | The source config associated with this source.

### Returns
None

## Staged Linked Source Status

Determines the status of a [Staging Source](Glossary.md#staging-source) to show end users whether it is healthy or not. Only applies when using a [Staged Linking](Glossary.md#staged-linking) strategy.
Required to implement for Delphix Engine operations:

* N/A

```python
from dlpx.virtualization import plugin
from dlpx.virtualization.platform import Status

plugin = plugin.Plugin()

@plugin.linked.status()
def linked_status(staged_source, repository, source_config):
  return Status.ACTIVE
```

### Signature

`def linked_status(staged_source, repository, source_config)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
staged_source | [StagedSource](Classes.md#stagedsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.
source_config | [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) | The source config associated with this source.

### Returns
[Status](Classes.md#status)

## Staged Linked Source Worker

Monitors the status of a [Staging Source](Glossary.md#staging-source) on a reqular interval. It can be used to fix up any errors on staging if it is not functioning as expected. Only applies when using a [Staged Linking](Glossary.md#staged-linking) strategy.
Required to implement for Delphix Engine operations:

* N/A

```python
from dlpx.virtualization import plugin

plugin = plugin.Plugin()

@plugin.linked.worker()
def worker(staged_source, repository, source_config):
  pass
```

### Signature

`def worker(staged_source, repository, source_config)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
staged_source | [StagedSource](Classes.md#stagedsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.
source_config | [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) | The source config associated with this source.

### Returns
None

## Staged Linked Source Mount Specification

Returns configurations for the mounts associated for data in staged source. The `ownership_specification` is optional. If not specified, the platform will default the ownership settings to the environment user used for the Delphix Operation.

!!!note
    `ownership_specification` only applies to Unix hosts.
Required to implement for Delphix Engine operations:

* Enable
* Sync

```python
from dlpx.virtualization import plugin
from dlpx.virtualization.platform import Mount
from dlpx.virtualization.platform import MountSpecification
from dlpx.virtualization.platform import OwenershipSpecification
from generated import SnapshotDefinition

plugin = plugin.Plugin()

@plugin.linked.mount_specification()
def linked_mount_specification(staged_source, repository):
  mount = Mount(staged_source.connection.environment, "/some/path")
  ownership_spec = OwenershipSpecification(repository.uid, repository.gid)

  return MountSpecification([mount], ownership_spec)
```

> The above command assumes a [Repository Schema](Schemas_and_Autogenerated_Classes.md#repository-schema) defined as:

```json
{
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "uid": { "type": "integer" },
    "gid": { "type": "integer" }
  }
}
```

### Signature

`def linked_mount_specification(staged_source, repository)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
staged_source | [StagedSource](Classes.md#stagedsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.

### Returns
[MountSpecification](Classes.md#mountspecification)

## Virtual Source Configure

Configures the data in a particular snapshot to be usable on a target environment. For database data files, this may mean recovering from a crash consistent format or backup. For application files, this may mean reconfiguring XML files or rewriting hostnames and symlinks.
Required to implement for Delphix Engine operations:

* [Provision](https://docs.google.com/document/d/1uUUiSKtPKyzJYXjeh4s49MZ_mXPiOh_mbSqqmw1m59M/edit#heading=h.cmmq92gwqotb)
* Refresh


```python
from dlpx.virtualization import plugin
from generated import SourceConfigDefinition

plugin = plugin.Plugin()

@plugin.virtual.configure()
def configure(virtual_source, repository, snapshot):
  name = "config_name"
  source_config = SourceConfigDefinition()
  source_config.name = name
  return source_config
```

> The above command assumes a [SourceConfig Schema](Schemas_and_Autogenerated_Classes.md#sourceconfig-schema) defined as:

```json
{
  "type": "object",
  "required": ["name"],
  "additionalProperties": false,
  "properties": {
    "name": { "type": "string" }
  },
  "identityFields": ["name"],
  "nameField": ["name"]
}
```

### Signature

`def configure(virtual_source, snapshot, repository)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
virtual_source | [VirtualSource](Classes.md#virtualsource) | The source associated with this operation.
snapshot | [SnapshotDefinition](Schemas_and_Autogenerated_Classes.md#snapshotdefinition-class) | The snapshot of the data set to configure.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.

### Returns
[SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class)

## Virtual Source Unconfigure

Quiesces the virtual source on a target environment. For database data files, shutting down and unregistering a database on a host.
Required to implement for Delphix Engine operations:

* Refresh
* Delete


```python
from dlpx.virtualization import plugin

plugin = plugin.Plugin()

@plugin.virtual.unconfigure()
def unconfigure(virtual_source, repository, snapshot):
  pass
```

### Signature

`def unconfigure(virtual_source, snapshot, repository)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
virtual_source | [VirtualSource](Classes.md#virtualsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.
source_config | [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) | The source config associated with this source.

### Returns
None

## Virtual Source Reconfigure

Re-configures the data for a virtual source to point to the data in a prior snapshot for the virtual source. For database data files, this may mean recovering from a crash consistent format or backup of a new snapshot. For application files, this may mean reconfiguring XML files or rewriting hostnames and symlinks.
Required to implement for Delphix Engine operations:

* Rollback

```python
from dlpx.virtualization import plugin
from generated import SourceConfigDefinition

plugin = plugin.Plugin()

@plugin.virtual.reconfigure()
def configure(virtual_source, repository, snapshot):
  name = "updated_config_name"
  source_config = SourceConfigDefinition()
  source_config.name = name
  return source_config
```

> The above command assumes a [SourceConfig Schema](Schemas_and_Autogenerated_Classes.md#sourceconfig-schema) defined as:

```json
{
  "type": "object",
  "required": ["name"],
  "additionalProperties": false,
  "properties": {
    "name": { "type": "string" }
  },
  "identityFields": ["name"],
  "nameField": ["name"]
}
```

### Signature

`def reconfigure(virtual_source, snapshot, repository)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
virtual_source | [VirtualSource](Classes.md#virtualsource) | The source associated with this operation.
snapshot | [SnapshotDefinition](Schemas_and_Autogenerated_Classes.md#snapshotdefinition-class) | The snapshot of the data set to configure.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.

### Returns
[SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class)

## Virtual Source Start

Executed whenever the data should be placed in a "running" state.
Required to implement for Delphix Engine operations:

* Start

```python
from dlpx.virtualization import plugin

plugin = plugin.Plugin()

@plugin.virtual.start()
def start(virtual_source, repository, source_config):
  pass
```

### Signature

`def start(virtual_source, repository, source_config)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
virtual_source | [VirtualSource](Classes.md#virtualsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.
source_config | [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) | The source config associated with this source.

### Returns
None

## Virtual Source Stop

Executed whenever the data needs to be shut down.
Required to implement for Delphix Engine operations:

* Stop

```python
from dlpx.virtualization import plugin

plugin = plugin.Plugin()

@plugin.virtual.stop()
def stop(virtual_source, repository, source_config):
  pass
```

### Signature

`def stop(virtual_source, repository, source_config)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
virtual_source | [VirtualSource](Classes.md#virtualsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.
source_config | [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) | The source config associated with this source.

### Returns
None

## Virtual Source Pre-Snapshot

Prepares the virtual source for taking a snapshot of the data.
Required to implement for Delphix Engine operations:

* Snapshot

```python
from dlpx.virtualization import plugin

plugin = plugin.Plugin()

@plugin.virtual.pre_snapshot()
def virtual_pre_snapshot(virtual_source, repository, source_config):
  pass
```

### Signature

`def virtual_pre_snapshot(virtual_source, repository, source_config)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
virtual_source | [VirtualSource](Classes.md#virtualsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.
source_config | [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) | The source config associated with this source.

### Returns
None

## Virtual Source Post-Snapshot

Captures metadata after a snapshot.
Required to implement for Delphix Engine operations:

* Snapshot

```python
from dlpx.virtualization import plugin
from generated import SnapshotDefinition

plugin = plugin.Plugin()

@plugin.virtual.post_snapshot()
def virtual_post_snapshot(virtual_source, repository, source_config):
  snapshot = SnapshotDefinition()
  snapshot.transaction_id = 1000
  return snapshot
```

> The above command assumes a [Snapshot Schema](Schemas_and_Autogenerated_Classes.md#snapshot-schema) defined as:

```json
{
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "transactionId": { "type": "string" }
  }
}
```

### Signature

`def virtual_post_snapshot(virtual_source, repository, source_config)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
virtual_source | [VirtualSource](Classes.md#virtualsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.
source_config | [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) | The source config associated with this source.

### Returns
[SnapshotDefinition](Schemas_and_Autogenerated_Classes.md#snapshotdefinition-class)

## Virtual Source Mount Specification

Returns configurations for the mounts associated for data in virtual source.
The `ownership_specification` is optional. If not specified, the platform will default the ownership settings to the environment user used for the Delphix Operation.

!!!note
    `ownership_specification` only applies to Unix hosts.
   
Required to implement for Delphix Engine operations:

* Enable
* Provision
* Refresh
* Rollback
* Start

```python
from dlpx.virtualization import plugin
from dlpx.virtualization.platform import Mount
from dlpx.virtualization.platform import MountSpecification
from dlpx.virtualization.platform import OwenershipSpecification
from generated import SnapshotDefinition

plugin = plugin.Plugin()

@plugin.virtual.mount_specification()
def virtual_mount_specification(virtual_source, repository):
  mount = Mount(virtual_source.connection.environment, "/some/path")
  ownership_spec = OwenershipSpecification(repository.uid, repository.gid)

  return MountSpecification([mount], ownership_spec)
```

> The above command assumes a [Repository Schema](Schemas_and_Autogenerated_Classes.md#repository-schema) defined as:

```json
{
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "uid": { "type": "integer" },
    "gid": { "type": "integer" }
  }
}
```

### Signature

`def virtual_mount_specification(virtual_source, repository)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
virtual_source | [VirtualSource](Classes.md#virtualsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.

### Returns
[MountSpecification](Classes.md#mountspecification)

## Virtual Source Status

Determines the status of a [Virtual Source](Glossary.md#virtual-source) to show end users whether it is healthy or not.
Required to implement for Delphix Engine operations:

* N/A

```python
from dlpx.virtualization import plugin
from dlpx.virtualization.platform import Status

plugin = plugin.Plugin()

@plugin.virtual.status()
def virtual_status(virtual_source, repository):
  return Status.ACTIVE
```

### Signature

`def virtual_status(staged_source, repository, source_config)`

### Arguments

Argument | Type | Description
-------- | ---- | -----------
virtual_source | [VirtualSource](Classes.md#virtualsource) | The source associated with this operation.
repository | [RepositoryDefinition](Schemas_and_Autogenerated_Classes.md#repositorydefinition-class) | The repository associated with this source.
source_config | [SourceConfigDefinition](Schemas_and_Autogenerated_Classes.md#sourceconfigdefinition-class) | The source config associated with this source.

### Returns
[Status](Classes.md#status)
